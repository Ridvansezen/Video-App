{% extends "base.html" %}
{% block title %}Kayıt Ol{% endblock %}

{% block content %}
{% load crispy_forms_tags %}
<div style="max-width: 500px; margin:auto;">
    <h2 class="mb-4 header-text">Kayıt Ol</h2>

    <div class="forms-block">

        <form method="post" enctype="multipart/form-data" id="registerForm">
            {% csrf_token %}

            <!-- JS info mesaj -->
            <div id="stepMessage" class="alert alert-info" style="display:none;"></div>

            <!-- Step 1 -->
            <div class="step active" id="step1">
                {{ form.username|as_crispy_field }}
                {{ form.password1|as_crispy_field }}
                {{ form.password2|as_crispy_field }}
                <button type="button" class="btn btn-primary mt-2 w-100 login-button" onclick="nextStep()">İleri</button>
            </div>

            <!-- Step 2 -->
            <div class="step" id="step2">
                {{ form.name|as_crispy_field }}
                {{ form.email|as_crispy_field }}
                {{ form.bio|as_crispy_field }}
                {{ form.profile_picture|as_crispy_field }}
                {{ form.birth_date|as_crispy_field }}
                <button type="submit" class="btn btn-primary mt-2 w-50 login-button">Kayıt Ol</button>
                <button type="button" class="btn btn-secondary mt-2 w-50 login-button-back" onclick="prevStep()">Geri</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
let currentStep = 1;

function nextStep() {
    const msgDiv = document.getElementById('stepMessage');
    
    // Step 1 validasyonu: username, password1, password2 boş mu kontrol et
    if(currentStep === 1) {
        const username = document.getElementById('id_username').value.trim();
        const password1 = document.getElementById('id_password1').value.trim();
        const password2 = document.getElementById('id_password2').value.trim();

        if(!username || !password1 || !password2){
            msgDiv.innerText = "Lütfen önce tüm alanları doldurun!";
            msgDiv.className = "alert alert-danger";
            msgDiv.style.display = "block";
            return; // diğer adıma geçme
        } else if(password1 !== password2){
            msgDiv.innerText = "Şifreler eşleşmiyor!";
            msgDiv.className = "alert alert-danger";
            msgDiv.style.display = "block";
            return;
        }
    }

    // Step geçişi
    document.getElementById('step' + currentStep).classList.remove('active');
    currentStep++;
    document.getElementById('step' + currentStep).classList.add('active');

    // Step 2 info mesajı
    if(currentStep === 2){
        msgDiv.innerText = "Şimdi diğer bilgilerini girin!";
        msgDiv.className = "alert alert-info";
        msgDiv.style.display = "block";
    } else {
        msgDiv.style.display = "none";
    }
}

function prevStep() {
    const msgDiv = document.getElementById('stepMessage');
    document.getElementById('step' + currentStep).classList.remove('active');
    currentStep--;
    document.getElementById('step' + currentStep).classList.add('active');

    if(currentStep === 2){
        msgDiv.innerText = "Şimdi diğer bilgilerini girin!";
        msgDiv.className = "alert alert-info";
        msgDiv.style.display = "block";
    } else {
        msgDiv.style.display = "none";
    }
}
</script>
{% endblock %}
