{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% get_media_prefix as MEDIA_URL %}

{% block content %}
  <div class="container mt-4 text-center">

    <div class="profile-picture-div mb-3">
      {% if user_obj.profile_picture %}
          <img src="{{ user_obj.profile_picture.url }}" alt="Profil" class="profile-picture" width="120" height="120">
      {% else %}
          <img src="{{ MEDIA_URL }}default.jpg" alt="Profil" class="profile-picture" width="120" height="120">
      {% endif %}
    </div>

    <h2 class="fs-2 profile-username d-inline">
      {{ user_obj.username }}
      {% if user_obj.is_verified %}
        <i class="fa-solid fa-circle-check text-primary verified-icon-profile" title="Doğrulandı"></i>
      {% endif %}
    </h2>
    {% if user_obj.username == "ridvan" %}
        <span class="badge bg-danger fs-6 align-middle ms-2">Admin</span>
    {% endif %}

    <p class="text-muted">{{ user_obj.name }}</p>

    {% if is_owner %}
      <button class="btn btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#editForm">
        Profili Düzenle
      </button>
    {% endif %}

    <br><br>

    <p class="text-muted">Katılma tarihi: {{ user_obj.joined_at|date:"d.m.Y"|default:"—" }}</p>

    <hr>

    <p>{{ user_obj.bio|default:"Henüz biyografi eklenmedi."|linebreaksbr }}</p>
    

    <hr>

    <h4 class="mt-4">Gönderiler</h4>

    <br>

    {% if is_owner %}
        <div class="dropdown mt-3">
          <button class="btn btn-primary dropdown-toggle mb-5" type="button" data-bs-toggle="dropdown" aria-expanded="false">
            Paylaş
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{% url 'posts:create_post' 'text' %}">Yazı Gönder</a></li>
            <li><a class="dropdown-item" href="{% url 'posts:create_post' 'image' %}">Fotoğraf Gönder</a></li>
            <li><a class="dropdown-item" href="{% url 'posts:create_post' 'video' %}">Video Gönder</a></li>
          </ul>
        </div>
    {% endif %}


    {% if posts %}
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-3">
        {% for post in posts %}
          <div class="col">
            {% include "posts/post_card.html" with post=post %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="text-muted">Henüz gönderi yok.</p>
  {% endif %}
    


    {% if is_owner %}
    <div class="collapse mt-4" id="editForm">
      <h4>Profili Düzenle</h4>
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form|crispy }}
        <button class="btn btn-success">Kaydet</button>
      </form>
    </div>
    {% endif %}
  </div>

{% endblock %}
