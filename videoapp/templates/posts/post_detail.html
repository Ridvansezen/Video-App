{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% get_media_prefix as MEDIA_URL %}

{% block content %}
<div class="container mt-4">
    <div class="card mb-3">
      <div class="card-header d-flex align-items-center">
        {% if post.user.profile_picture %}
          <img src="{{ post.user.profile_picture.url }}" alt="Profil" class="rounded-circle me-2" width="40" height="40">
        {% else %}
          <img src="{{ MEDIA_URL }}default.jpg" alt="Profil" class="rounded-circle me-2" width="40" height="40">
        {% endif %}
            <strong>
            <a class="text-dark text-decoration-none" href="{% url 'profile' post.user.username %}">
              {{ post.user.username }}
            </a>
          </strong>
      </div>
  
      <div class="card-body">
  
        {% if post.content %}
          <p class="card-text">{{ post.content|linebreaksbr }}</p>
        {% endif %}
  
        {% if post.image %}
          <div class="media-container mb-2">
            <img src="{{ post.image.url }}" alt="Fotoğraf">
          </div>
        {% elif post.video %}
          <div class="media-container mb-2">
            <video controls>
              <source src="{{ post.video.url }}" type="video/mp4">
              Tarayıcınız video oynatmayı desteklemiyor.
            </video>
          </div>
        {% endif %}
  
        {% if request.user.is_authenticated %}
          <!-- Like / Save / Comment alanı -->
          <div class="d-flex align-items-center mt-2">
            <form action="{% url 'posts:toggle_like' post.pk %}" method="post" class="me-2">
              {% csrf_token %}
              <button class="btn btn-outline-danger btn-sm">
                {% if user_liked %}❤️{% else %}🤍{% endif %} {{ post.like_count }}
              </button>
            </form>
  
            <form action="{% url 'posts:toggle_save' post.pk %}" method="post" class="me-2">
              {% csrf_token %}
              <button class="btn btn-outline-primary btn-sm">
                {% if user_saved %}🔖 Kaydedildi{% else %}📑 Kaydet{% endif %}
              </button>
            </form>
  
            <span class="ms-auto">{{ post.comment_count }} Yorum</span>
          </div>
  
          <!-- Yorumlar -->
          <hr>
          <h5>Yorumlar</h5>
          <br>
          <div>
            {% for comment in post.comments.all %}
            <div class="mb-3">
                <strong>
                  <a href="{% url 'profile' comment.user.username %}" class="text-dark text-decoration-none">
                    {{ comment.user.username }}
                  </a>
                </strong>: {{ comment.text }}
              </div>
            {% empty %}
              <p>Henüz yorum yok.</p>
            {% endfor %}
          </div>
  
          <form method="post">
            {% csrf_token %}
            {{ comment_form|crispy }}
            <button class="btn btn-primary btn-sm mt-2">Yorum Yap</button>
          </form>
        {% endif %}
  
      </div>
    </div>
  </div>
  
  
  
{% endblock %}
